openapi: 3.0.0
info:
  title: Express API
  version: 1.0.0

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

security:
  - bearerAuth: []


paths:


  /users:
    get:
      summary: Получить список пользователей
      description: Возвращает всех пользователей с их ролями, общее количество и количество страниц.
      tags:
        - Users
      responses:
        '200':
          description: Успешный ответ
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: integer
                          example: 1
                        name:
                          type: string
                          example: Ivan
                        email:
                          type: string
                          example: ivan@example.com
                        role:
                          type: object
                          properties:
                            id:
                              type: integer
                              example: 1
                            name:
                              type: string
                              example: Admin
                  total_count:
                    type: integer
                    example: 100
                  total_page:
                    type: integer
                    example: 5
        '400':
          description: Ошибка при получении пользователей
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Unexpected error!
                  error:
                    type: string
                    example: Cannot read properties of undefined

  /users/sign-up:
    post:
      summary: Регистрация нового пользователя
      description: Создаёт нового пользователя после валидации данных и проверки уникальности email, username и социальных сетей.
      tags:
        - Users
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - username
                - email
                - password
                - roleId
              properties:
                username:
                  type: string
                  example: johndoe
                email:
                  type: string
                  example: johndoe@example.com
                password:
                  type: string
                  minLength: 6
                  maxLength: 10
                  example: MyPass1
                roleId:
                  type: string
                  format: uuid
                  example: 123e4567-e89b-12d3-a456-426614174000
                telegram:
                  type: string
                  example: johndoe
                facebook:
                  type: string
                  example: johndoe.fb
                instagram:
                  type: string
                  example: johndoe.ig
                image:
                  type: string
                  example: https://example.com/profile.jpg
      responses:
        '200':
          description: Пользователь успешно зарегистрирован, требуется подтверждение аккаунта
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Verify your account
                  data:
                    type: object
                    properties:
                      username:
                        type: string
                        example: johndoe
                      email:
                        type: string
                        example: johndoe@example.com
        '400':
          description: Ошибка валидации или пользователь уже существует
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: User with this email or username already exists.
                  error:
                    type: string
                    example: Unexpected error!
        '404':
          description: Указанная роль не найдена
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Role with this id not found.

  /users/send-otp:
    post:
      summary: Отправка OTP-кода на почту пользователя
      description: Генерирует и сохраняет одноразовый OTP-код, если пользователь существует и не превышен лимит. Старые коды удаляются. Новый код отправляется на email.
      tags:
        - Users
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - to
                - subject
              properties:
                to:
                  type: string
                  format: email
                  example: user@example.com
                subject:
                  type: string
                  example: OTP Verification
      responses:
        '200':
          description: OTP успешно отправлен на указанную почту
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: OTP sent successfully
        '400':
          description: Не передан email или subject
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Email and subject are required!
        '404':
          description: Пользователь с указанной почтой не найден
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: User with this email not found
        '429':
          description: OTP уже был отправлен недавно, ещё не истёк
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: OTP already sent recently. Please wait until it expires.
                  expiresAt:
                    type: string
                    format: date-time
                    example: 2025-06-11T10:12:00.000Z
        '500':
          description: Неожиданная ошибка сервера
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Unexpected error. Please try again later.

  /users/verify-otp:
    post:
      summary: Верификация OTP-кода пользователя
      description: Проверяет действующий OTP-код по email и активирует учётную запись. Удаляет использованный код.
      tags:
        - Users
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - otp_code
              properties:
                email:
                  type: string
                  format: email
                  example: user@example.com
                otp_code:
                  type: string
                  example: "123456"
      responses:
        '200':
          description: Аккаунт успешно активирован
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Account successfully activated
        '400':
          description: Неверный код, истёкший код или неполные данные
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Invalid OTP code
        '404':
          description: Пользователь с такой почтой не найден
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: User with this email not found
        '500':
          description: Неожиданная ошибка сервера
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Unexpected error. Please try again later.

  /users/sign-in:
    post:
      summary: Авторизация пользователя
      description: Авторизует пользователя по email и паролю, создаёт сессию, устанавливает refresh токен в куку и возвращает access токен.
      tags:
        - Users
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  format: email
                  example: user@example.com
                password:
                  type: string
                  example: MySecret123
      responses:
        '200':
          description: Успешный вход
          headers:
            Set-Cookie:
              description: Устанавливает refresh_token в куку
              schema:
                type: string
                example: refresh_token=abc.def.ghi; HttpOnly
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Successfully login!
                  accessToken:
                    type: string
                    example: eyJhbGciOiJIUzI1NiIsInR5cCI6...
        '403':
          description: Неверный пароль
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Invalid credentials
        '404':
          description: Пользователь или роль не найдены
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: User with this email not found
        '500':
          description: Внутренняя ошибка сервера
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Unexpected error. Please try again later.

  /users/get-my-data:
    get:
      summary: Получить данные текущего пользователя
      description: Возвращает подробную информацию о текущем пользователе, включая сессии, блокировки и статус активации. Требуется авторизация.
      tags:
        - Users
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Данные пользователя успешно получены
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                    format: uuid
                  email:
                    type: string
                    format: email
                  username:
                    type: string
                  status:
                    type: string
                    example: ACTIVE
                  Sessions:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                        ip:
                          type: string
                        deviceType:
                          type: string
                        browser:
                          type: string
                        date:
                          type: string
                          format: date-time
                        endDate:
                          type: string
                          format: date-time
                  Ban:
                    type: object
                    nullable: true
                    properties:
                      id:
                        type: string
                      ban_reason:
                        type: string
                  Activation:
                    type: object
                    nullable: true
                    properties:
                      id:
                        type: string
                      activation_status:
                        type: string
        '401':
          description: Пользователь не авторизован или сессия недействительна
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: not authorized
        '500':
          description: Ошибка сервера
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Unexpected error. Please try again later.

  /users/update-self/{id}:
    patch:
      summary: Обновить свои данные
      description: Обновляет профиль пользователя по его ID. Доступ разрешён ролям USER, ADMIN, SUPER ADMIN. Требуется авторизация.
      tags:
        - Users
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: ID пользователя, которого нужно обновить
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                username:
                  type: string
                  example: bonu_ham
                telegram:
                  type: string
                  example: bonu_ham
                facebook:
                  type: string
                  example: bonu.fb
                instagram:
                  type: string
                  example: bonu.ig
  
      responses:
        '200':
          description: Данные пользователя успешно обновлены
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Username updated successfully
                  updated_user:
                    type: object
        '400':
          description: Ошибка валидации
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Invalid input data
        '401':
          description: Неавторизованный доступ
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Unauthorized
        '500':
          description: Неожиданная ошибка сервера
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Unexpected error. Please try again later.

  /users/send-otp-reset:
    post:
      summary: Отправка OTP-кода для восстановления пароля
      description: Отправляет одноразовый код (OTP) на указанную почту, если пользователь существует. Блокирует повторную отправку до истечения срока действия.
      tags:
        - Users
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - to
                - subject
              properties:
                to:
                  type: string
                  format: email
                  example: user@example.com
                subject:
                  type: string
                  example: Password Reset Request
      responses:
        '200':
          description: OTP отправлен успешно
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: OTP sent successfully
        '403':
          description: Не указана почта или тема письма
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: Email and subject are required!
        '404':
          description: Пользователь с такой почтой не найден
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: User not found
        '429':
          description: OTP уже был отправлен недавно
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: OTP already sent recently. Please wait until it expires before requesting a new one.
                  expiresAt:
                    type: string
                    format: date-time
        '500':
          description: Неожиданная ошибка сервера
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Unexpected error. Please try again later.

  /users/verify-otp-reset:
    post:
      summary: Подтверждение OTP-кода для сброса пароля
      description: Проверяет правильность введённого OTP-кода. Если всё верно — разрешает сброс пароля.
      tags:
        - Users
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - otp_code
              properties:
                email:
                  type: string
                  format: email
                  example: user@example.com
                otp_code:
                  type: string
                  example: "123456"
      responses:
        '200':
          description: OTP успешно подтверждён
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: OTP verified. You can now reset your password.
        '400':
          description: Неверный или просроченный код
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Wrong OTP code
        '404':
          description: Пользователь не найден
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: User not found
        '500':
          description: Неожиданная ошибка сервера
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Unexpected error. Please try again later.

  /users/reset-password:
    post:
      summary: Сброс пароля после подтверждения OTP
      description: Позволяет пользователю задать новый пароль после подтверждённого OTP. Требуется валидация пароля и проверка, что OTP был подтверждён и не истёк.
      tags:
        - Users
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - newPassword
              properties:
                email:
                  type: string
                  format: email
                  example: user@example.com
                newPassword:
                  type: string
                  example: NewPass123
      responses:
        '200':
          description: Пароль успешно обновлён
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Password successfully reset
        '400':
          description: Ошибка валидации или слабый пароль
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Password should have at least one uppercase, one lowercase, and one number.
        '403':
          description: OTP не подтверждён или срок действия истёк
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: OTP not verified or expired
        '404':
          description: Пользователь не найден
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: User not found
        '500':
          description: Неожиданная ошибка сервера
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Unexpected error. Please try again later.

  /users/logout:
    post:
      summary: Logout user and clear refresh token
      tags:
        - Users
      responses:
        '200':
          description: Logged out successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Logged out successfully
        '500':
          description: Logout failed
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Logout failed. Try again later.


  /users/ban-user:
    post:
      summary: Заблокировать пользователя
      description: Админ может заблокировать пользователя по ID. Пользователь получает статус "BANNED" и записывается причина бана.
      tags:
        - Manage Users
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - userId
                - ban_reason
              properties:
                userId:
                  type: string
                  format: uuid
                  example: 123e4567-e89b-12d3-a456-426614174000
                ban_reason:
                  type: string
                  example: Нарушение правил сервиса
      responses:
        '200':
          description: Пользователь успешно заблокирован
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: User successfully banned
        '400':
          description: Ошибка валидации входных данных
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: userId is required
        '403':
          description: Пользователь уже заблокирован или недостаточно прав
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: User is already banned
        '404':
          description: Пользователь не найден
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: User not found
        '500':
          description: Неожиданная ошибка сервера
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Unexpected error. Please try again later.

  /users/activate-user:
    post:
      summary: Активировать пользователя вручную
      description: Админ или супер-админ активирует пользователя по ID, если он ещё не активен.
      tags:
        - Manage Users
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - userId
              properties:
                userId:
                  type: string
                  format: uuid
                  example: 123e4567-e89b-12d3-a456-426614174000
      responses:
        '200':
          description: Пользователь успешно активирован
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: User successfully activated
        '400':
          description: Ошибка валидации запроса
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: userId is required
        '403':
          description: Пользователь уже активен или активирован ранее
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: User already active
        '404':
          description: Пользователь не найден
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: User not found
        '500':
          description: Внутренняя ошибка сервера
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Unexpected error. Please try again later.

  /users/refresh-token:
    post:
      summary: Обновить access токен
      description: Возвращает новый access токен на основе refresh токена из cookie. Обновляет поле was_online у пользователя.
      tags:
        - Manage Users
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Access токен успешно обновлён
          content:
            application/json:
              schema:
                type: object
                properties:
                  access_token:
                    type: string
                    example: eyJhbGciOiJIUzI1NiIsInR5cCI6...
                  updateUser:
                    type: object
                    properties:
                      id:
                        type: string
                      email:
                        type: string
                      was_online:
                        type: string
                        format: date-time
        '401':
          description: Refresh токен отсутствует, просрочен или некорректен
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Refresh token expired, please sign in again.
        '500':
          description: Неожиданная ошибка сервера
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Unexpected error. Please try again later.




  /users/get-my-sessions:
    get:
      summary: Получить список своих сессий
      description: Возвращает все сессии текущего авторизованного пользователя. Требуется валидная сессия и access token.
      tags:
        - Session
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Сессии успешно получены
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                          format: uuid
                        ip:
                          type: string
                          example: 192.168.1.1
                        location:
                          type: string
                          nullable: true
                          example: Tashkent, Uzbekistan
                        info:
                          type: string
                          example: Desktop, Windows, Chrome, вход 2025-06-11 14:22
                        deviceType:
                          type: string
                          example: desktop
                        browser:
                          type: string
                          example: Chrome
                        date:
                          type: string
                          format: date-time
                        endDate:
                          type: string
                          format: date-time
                          nullable: true
        '401':
          description: Пользователь не авторизован или сессия недействительна
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Unauthorized
        '500':
          description: Ошибка сервера
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Unexpected error. Please try again later.

  /users/del-my-sessions/{id}:
    delete:
      summary: Удалить свою сессию
      description: Удаляет конкретную сессию пользователя по ID. Если сессия принадлежит текущему пользователю, она удаляется, а статус пользователя меняется на `PENDING`.
      tags:
        - Session
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          description: ID удаляемой сессии
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Сессия успешно удалена
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Session deleted
        '403':
          description: Пользователь не имеет доступа к этой сессии
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Not authorized to delete this session
        '404':
          description: Сессия не найдена
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Session not found
        '500':
          description: Внутренняя ошибка сервера
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Unexpected error. Please try again later.

  /users/session-end:
    patch:
      summary: Завершить активную сессию вручную
      description: Завершает пользовательскую сессию, устанавливая время завершения. Доступно только для ADMIN и SUPER ADMIN.
      tags:
        - Session
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - sessionId
                - endDate
              properties:
                sessionId:
                  type: string
                  format: uuid
                  example: 123e4567-e89b-12d3-a456-426614174000
                endDate:
                  type: string
                  format: date-time
                  example: 2025-06-11T15:00:00.000Z
      responses:
        '200':
          description: Сессия успешно завершена
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Session ended
                  session:
                    type: object
                    properties:
                      id:
                        type: string
                      endDate:
                        type: string
                        format: date-time
        '400':
          description: Ошибка валидации или логики (например, сессия уже завершена)
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: End time must be after start time
        '404':
          description: Сессия не найдена
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Session not found
        '500':
          description: Внутренняя ошибка сервера
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Unexpected error. Please try again later.



  /users/upload:
    post:
      summary: Загрузить изображение профиля
      description: Принимает файл изображения в формате jpeg, png или webp и сохраняет его как аватар пользователя.
      tags:
        - Uploads
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - image
              properties:
                image:
                  type: string
                  format: binary
                  description: Изображение профиля (jpeg, png, webp)
      responses:
        '201':
          description: Файл успешно загружен
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: string
                    example: http://localhost:3300/users/image/example.jpg
        '400':
          description: Неверный формат файла
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Можно загружать только изображения (jpeg, png, webp)
        '500':
          description: Неожиданная ошибка при загрузке
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Unexpected error. Please try again later.


  /users/uploads/file:
    post:
      summary: Upload media file
      description: Uploads an image (jpeg, png, webp, jpg) and returns its URL.
      tags:
        - Uploads
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
                  description: The media file to upload (jpeg, png, webp, jpg)
      responses:
        '201':
          description: File uploaded successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: File uploaded successfully
                  mediaUrl:
                    type: string
                    example: http://localhost:3300/users/file/1719324502819.jpg
        '400':
          description: No file uploaded
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: No file uploaded
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Server error























  /users/roles:
    get:
      summary: Получить список всех ролей
      tags:
        - Roles
      responses:
        '200':
          description: Успешное получение списка ролей
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                          format: uuid
                        name:
                          type: string
                          example: ADMIN
        '500':
          description: Ошибка сервера

  /users/role/{id}:
    get:
      summary: Получить роль по ID
      tags:
        - Roles
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Роль найдена
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      id:
                        type: string
                      name:
                        type: string
                        example: ADMIN
        '404':
          description: Роль не найдена
        '500':
          description: Ошибка сервера

  /users/role:
    post:
      summary: Создать новую роль
      tags:
        - Roles
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
              properties:
                name:
                  type: string
                  example: MANAGER
      responses:
        '200':
          description: Роль успешно создана
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      id:
                        type: string
                      name:
                        type: string
                        example: MANAGER
        '403':
          description: Ошибка валидации или недостаточно прав
        '500':
          description: Ошибка сервера

  /users/role-update/{id}:
    patch:
      summary: Обновить роль по ID
      tags:
        - Roles
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
              properties:
                name:
                  type: string
                  example: MODERATOR
      responses:
        '200':
          description: Роль успешно обновлена
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Role updated successfully
                  data:
                    type: object
        '403':
          description: Ошибка валидации или нет прав
        '404':
          description: Роль не найдена
        '500':
          description: Ошибка сервера

  /users/role-delete/{id}:
    delete:
      summary: Удалить роль по ID
      tags:
        - Roles
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Роль успешно удалена
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Role deleted successfully
                  data:
                    type: object
        '404':
          description: Роль не найдена
        '500':
          description: Ошибка сервера



  /users/average-time-statistics/{period}:
   get:
    summary: Get average session time statistics
    tags:
      - Statistics
    parameters:
      - name: period
        in: path
        required: true
        schema:
          type: string
          enum: [day, month, year, custom]
        description: Period to filter sessions
      - name: day
        in: query
        schema:
          type: integer
        description: Used with custom period (e.g., 2)
      - name: month
        in: query
        schema:
          type: integer
          minimum: 1
          maximum: 12
        description: Used with custom period (e.g., 06 )
      - name: year
        in: query
        schema:
          type: integer
        description: Used with custom period (e.g., 2025)
    responses:
      '200':
        description: Average session time returned
        content:
          application/json:
            schema:
              type: object
              properties:
                averageSessionTime:
                  type: string
                  example: "1h 32m"
                totalSessions:
                  type: integer
      '404':
        description: No completed sessions found
      '500':
        description: Internal server error


  /users/browsers_statistics/{period}:
   get:
    summary: Get statistics of used browsers
    tags:
      - Statistics
    parameters:
      - name: period
        in: path
        required: true
        schema:
          type: string
          enum: [day, month, year, custom]
      - name: day
        in: query
        schema:
          type: integer
          format: date
        description: Used with custom period
      - name: month
        in: query
        schema:
          type: integer
        description: Used with custom period
      - name: year
        in: query
        schema:
          type: integer
        description: Used with custom period
    responses:
      '200':
        description: Browsers statistics with percentages
        content:
          application/json:
            schema:
              type: array
              items:
                type: object
                properties:
                  browser:
                    type: string
                  count:
                    type: integer
                  percentage:
                    type: string
                    example: "25%"
      '500':
        description: Internal server error


  /users/devices-statistics/{period}:
   get:
    summary: Get statistics of device types
    tags:
      - Statistics
    parameters:
      - name: period
        in: path
        required: true
        schema:
          type: string
          enum: [day, month, year, custom]
      - name: day
        in: query
        schema:
          type: integer
      - name: month
        in: query
        schema:
          type: integer
      - name: year
        in: query
        schema:
          type: integer
    responses:
      '200':
        description: Devices statistics with percentages
        content:
          application/json:
            schema:
              type: array
              items:
                type: object
                properties:
                  deviceType:
                    type: string
                  count:
                    type: integer
                  percentage:
                    type: string
                    example: "40%"
      '500':
        description: Internal server error


  /users/user-statistics/{period}:
    get:
      summary: Get active user statistics
      tags:
        - Statistics
      parameters:
        - name: period
          in: path
          required: true
          schema:
            type: string
            enum: [day, month, year, custom]
        - name: day
          in: query
          required: false
          schema:
            type: integer
            example: "12"
        - name: month
          in: query
          required: false
          schema:
            type: integer
            example: 6
            minimum: 1
            maximum: 12
        - name: year
          in: query
          required: false
          schema:
            type: integer
            example: 2025
      responses:
        '200':
          description: User count and page count
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      total_count:
                        type: integer
                        example: 123
                      total_page:
                        type: integer
                        example: 5
        '500':
          description: Internal server error
  

  /users/page-statistics/{period}:
    get:
      summary: Получить статистику по просмотрам страниц
      description: |
        Возвращает количество просмотров каждой страницы с возможностью фильтрации по периоду.
        Если данных за указанный период нет — возвращает последние самые просматриваемые страницы.
      tags:
        - Statistics
      parameters:
        - name: period
          in: path
          required: true
          schema:
            type: string
            enum: [day, month, year, custom]
          description: Период для фильтрации (день, месяц, год или custom)
        - name: day
          in: query
          required: false
          schema:
            type: integer
          description: День (только для custom)
        - name: month
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 12
          description: Месяц (только для custom)
        - name: year
          in: query
          required: false
          schema:
            type: integer
          description: Год (только для custom)
      responses:
        '200':
          description: Успешный ответ со статистикой по страницам
          content:
            application/json:
              schema:
                oneOf:
                  - type: array
                    items:
                      type: object
                      properties:
                        name:
                          type: string
                          example: /home
                        count:
                          type: integer
                          example: 120
                        percentage:
                          type: string
                          example: "40%"
                  - type: object
                    properties:
                      message:
                        type: string
                        example: No data found in the given range. Returning recent page stats.
                      data:
                        type: array
                        items:
                          type: object
                          properties:
                            name:
                              type: string
                            count:
                              type: integer
                            percentage:
                              type: string
        '500':
          description: Внутренняя ошибка сервера
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Unexpected error. Please try again later.

      
  /users/log-page-view:
    post:
      summary: Сохранить просмотр страницы
      description: Логирует факт просмотра страницы пользователем (или анонимно).
      tags:
        - Pages
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  example: /home
      responses:
        '201':
          description: Просмотр страницы успешно сохранён
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Page view logged
        '400':
          description: Не указано имя страницы
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Page name is required
        '500':
          description: Внутренняя ошибка сервера
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Server error


  /users/get-logs:
    get:
      summary: Retrieve request logs with pagination
      description: Returns a paginated list of request logs, sorted by newest first.
      tags:
        - Logs
      parameters:
        - name: page
          in: query
          description: Page number (default is 1)
          required: false
          schema:
            type: integer
            example: 1
        - name: limit
          in: query
          description: Number of logs per page (default is 50)
          required: false
          schema:
            type: integer
            example: 50
      responses:
        '200':
          description: A list of request logs
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: integer
                          example: 1
                        method:
                          type: string
                          example: GET
                        url:
                          type: string
                          example: /api/users
                        ip:
                          type: string
                          example: 127.0.0.1
                        userAgent:
                          type: string
                          example: Mozilla/5.0 (Windows NT 10.0; Win64; x64)
                        userId:
                          type: integer
                          nullable: true
                          example: 42
                        responseCode:
                          type: integer
                          example: 200
                        responseTimeMs:
                          type: integer
                          example: 123
                        createdAt:
                          type: string
                          format: date-time
                          example: 2025-06-11T12:34:56.000Z
                  meta:
                    type: object
                    properties:
                      totalLogs:
                        type: integer
                        example: 153
                      currentPage:
                        type: integer
                        example: 1
                      totalPages:
                        type: integer
                        example: 4
                      limitPerPage:
                        type: integer
                        example: 50
        '500':
          description: Server error
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: Failed to retrieve logs. Please try again later.


  /users/start-chat:
      post:
        tags: [Chat]
        summary: Начать чат-сессию (клиент)
        security:
          - bearerAuth: []
        responses:
          '201':
            description: Сессия создана
          '200':
            description: Уже существует активная сессия
          '500':
            description: Ошибка сервера

  /users/get-flows:
    get:
      tags: [Chat]
      summary: Получить список всех открытых и активных сессий
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Список чатов
        '500':
          description: Ошибка сервера

  /users/connect-chat/{sessionId}:
    patch:
      tags:
        - Chat
      summary: Админ подключается к сессии
      security:
        - bearerAuth: []
      parameters:
        - name: sessionId
          in: path
          required: true
          description: ID сессии, к которой подключается админ
          schema:
            type: string
            example: 8de13d15-6344-4450-a51b-d37a321639ec
      responses:
        '200':
          description: Подключено
        '400':
          description: Сессия уже закрыта
        '404':
          description: Сессия не найдена
        '500':
          description: Внутренняя ошибка сервера

  /users/send-message/{sessionId}:
    post:
      tags:
        - Chat
      summary: Отправить сообщение в чат
      security:
        - bearerAuth: []
      parameters:
        - name: sessionId
          in: path
          required: true
          description: ID сессии чата
          schema:
            type: string
            example: 8de13d15-6344-4450-a51b-d37a321639ec
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                content:
                  type: string
                  description: Текст сообщения
                  example: Привет, как дела?
                mediaUrl:
                  type: string
                  description: URL медиафайла
                  example: http://localhost:3300/users/file/1750935526357.pdf
              anyOf:
                - required: [content]
                - required: [mediaUrl]
      responses:
        '201':
          description: Сообщение успешно отправлено
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Message sent successfully
                  data:
                    type: object
                    properties:
                      id:
                        type: string
                        example: "ca6b5674-1a18-4c31-8136-5b0b6d5585fb"
                      sessionId:
                        type: string
                        example: "8de13d15-6344-4450-a51b-d37a321639ec"
                      senderId:
                        type: string
                        example: "c7d24445-3644-4422-bdff-6f56e9127784"
                      content:
                        type: string
                        nullable: true
                        example: Привет, как дела?
                      mediaUrl:
                        type: string
                        nullable: true
                        example: http://localhost:3300/users/file/1750935526357.pdf
                      createdAt:
                        type: string
                        format: date-time
                        example: 2025-06-26T12:00:00.000Z
        '400':
          description: Контент отсутствует, превышен лимит сообщений или сессия закрыта
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Message must have either text or media
        '403':
          description: Превышено допустимое количество сообщений в сессии
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: This session already has two messages.
        '404':
          description: Сессия не найдена
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Session not found
        '500':
          description: Внутренняя ошибка сервера
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Server error

  /users/get-message:
    get:
      tags: [Chat]
      summary: Получить все сообщения по сессии
      security:
        - bearerAuth: []
      parameters:
        - name: sessionId
          in: query
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Список сообщений
        '404':
          description: Сессия не найдена
        '500':
          description: Ошибка сервера

  /users/chat-session-archive/{sessionId}:
    patch:
      summary: Архивировать чат-сессию
      description: Обновляет статус чат-сессии на ARCHIVED (мягкое удаление).
      tags:
        - Chat
      parameters:
        - name: sessionId
          in: path
          required: true
          description: Уникальный ID чат-сессии
          schema:
            type: string
      responses:
        '200':
          description: Сессия успешно архивирована
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Chat session archived successfully
        '404':
          description: Сессия не найдена
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Chat session not found
        '500':
          description: Внутренняя ошибка сервера
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Unexpected error. Please try again later.


  /users/message-isRead/{messageId}:
    patch:
      summary: Отметить сообщение как прочитанное
      tags:
        - Chat
      parameters:
        - name: messageId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Сообщение обновлено
        '404':
          description: Сообщение не найдено



  /users/archive-messages:
    get:
      tags:
        - Chat
      summary: Получить список заархивированных чатов
      description: Возвращает все чаты со статусом `ARCHIVED`.
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Успешный ответ. Список заархивированных сессий.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: integer
                          example: 1
                        clientId:
                          type: string
                          example: "user123"
                        adminId:
                          type: string
                          example: "admin456"
                        status:
                          type: string
                          example: "ARCHIVED"
                        createdAt:
                          type: string
                          format: date-time
                        updatedAt:
                          type: string
                          format: date-time
        '401':
          description: Неавторизован. Необходим действительный токен доступа.
        '500':
          description: Внутренняя ошибка сервера



  /users/closed-messages:
    get:
      tags:
        - Chat
      summary: Получить список закрытых чатов
      description: Возвращает все чаты со статусом `CLOSED`.
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Успешный ответ. Список закрытых сессий.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: integer
                          example: 1
                        clientId:
                          type: string
                          example: "user123"
                        adminId:
                          type: string
                          example: "admin456"
                        status:
                          type: string
                          example: "CLOSED"
                        createdAt:
                          type: string
                          format: date-time
                        updatedAt:
                          type: string
                          format: date-time
        '401':
          description: Неавторизован. Требуется токен.
        '500':
          description: Внутренняя ошибка сервера.


  /users/favorites/{messageId}:
    post:
      summary: Добавить сообщение в избранное
      description: Добавляет конкретное сообщение в избранное текущего пользователя.
      tags:
        - Favorites
      parameters:
        - name: messageId
          in: path
          required: true
          description: ID сообщения, которое нужно добавить в избранное
          schema:
            type: string
      responses:
        '201':
          description: Сообщение успешно добавлено в избранное
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Added to favorites
        '400':
          description: Сообщение уже находится в избранном
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Message already in favorites
        '500':
          description: Внутренняя ошибка сервера



  /users/favorites-del/{messageId}:
    delete:
      summary: Удалить сообщение из избранного
      description: Удаляет сообщение из избранного текущего пользователя.
      tags:
        - Favorites
      parameters:
        - name: messageId
          in: path
          required: true
          description: ID избранного сообщения, которое нужно удалить
          schema:
            type: string
      responses:
        '200':
          description: Сообщение успешно удалено из избранного
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Removed from favorites
        '404':
          description: Сообщение не найдено в избранном
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Favorite not found
        '500':
          description: Внутренняя ошибка сервера


  /users/favorites:
    get:
      summary: Получить все избранные сообщения пользователя
      description: Возвращает список всех сообщений, добавленных пользователем в избранное.
      tags:
        - Favorites
      responses:
        '200':
          description: Успешный запрос. Возвращает массив избранных сообщений.
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: string
                      example: 123e4567-e89b-12d3-a456-426614174000
                    message:
                      type: object
                      properties:
                        id:
                          type: string
                        content:
                          type: string
                        createdAt:
                          type: string
                        sender:
                          type: object
                          properties:
                            id:
                              type: string
                            username:
                              type: string
                        session:
                          type: object
                          properties:
                            id:
                              type: string
                            status:
                              type: string
        '500':
          description: Внутренняя ошибка сервера
